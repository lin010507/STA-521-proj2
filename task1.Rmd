---
title: "task1"
author: "Yanjiao Yang, Huiying Lin"
date: "2022-11-15"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(patchwork)
knitr::opts_chunk$set(echo = TRUE)
```

```{r load data}
imagem1 = read.table("imagem1.txt")
imagem2 = read.table("imagem2.txt")
imagem3 = read.table("imagem3.txt")

# change colnames
names = c("y", "x", "label", "NDAI", "SD", "CORR", "DF", "CF", "BF", "AF", "AN")
colnames(imagem1) = names
colnames(imagem2) = names
colnames(imagem3) = names
```

# b
As for the first image, 37.3% pixels are labeled as "not cloud", 34.1% are labeled as "cloud" and 28.6% have no labels. As for the second image, there are 43.8% labeled as "not cloud", 17.8% labeled as "cloud" and 38.5% with no labels. As for the third image, 29.3% are labeled as "not cloud", 18.4% are labeled as "cloud" and 52.3% have no labels.
```{r summarize the data}
imagem1 %>%
  group_by(label, .drop=TRUE) %>%
  summarise(n()/dim(.)[1])

imagem2 %>%
  group_by(label, .drop=TRUE) %>%
  summarise(n()/dim(.)[1])

imagem3 %>%
  group_by(label, .drop=TRUE) %>%
  summarise(n()/dim(.)[1])
```

pattern: no single pixels are labeled as cloud. Pixels are spatially related to each other in a sense that the neighbour of a pixel labeled as cloud tend to be cloudy. IID damei.


```{r plot maps, cache=TRUE, fig.height=8}
p1 = imagem1 %>%
  filter(label!=0) %>%
  ggplot(aes(x = x, y = y, col = factor(label)))+
  geom_point()+
  scale_color_manual(values = c("grey", "white"))+
  labs(x = "x", y = "y")+
  theme(legend.position = "none",
        panel.border = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "black"))

p2 = imagem2 %>%
  filter(label!=0) %>%
  ggplot(aes(x = x, y = y, col = factor(label)))+
  geom_point()+
  scale_color_manual(values = c("grey", "white"))+
  labs(x = "x", y = "y")+
  theme(legend.position = "none",
        panel.border = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "black"))

p3 = imagem3 %>%
  filter(label!=0) %>%
  ggplot(aes(x = x, y = y, col = factor(label)))+
  geom_point()+
  scale_color_manual(values = c("grey", "white"))+
  labs(x = "x", y = "y")+
  theme(legend.position = "none",
        panel.border = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "black"))

p1+p2+p3+plot_layout(nrow = 3, ncol = 1)
```

## c

```{r pairwise relationship, cache=TRUE}
library(GGally)
imagem1 %>%
  select(V3:V11) %>%
  ggpairs()
```

```{r corplot, cache=TRUE}
# pairwise correlation between features
imagem1 %>%
  select(NDAI:AN) %>%
  ggcorr(label = TRUE, label_alpha = TRUE, low = "steelblue", mid = "white", high = "darkred")
```

```{r}
imagem2 %>%
  select(NDAI:AN) %>%
  ggcorr(label = TRUE, label_alpha = TRUE, low = "steelblue", mid = "white", high = "darkred")
```

```{r}
imagem3%>%
  select(NDAI:AN) %>%
  ggcorr(label = TRUE, label_alpha = TRUE, low = "steelblue", mid = "white", high = "darkred")
```

Only show imagem1.
CORR: --- 5th MISR view direction (An)

NDAI: SD

V11 (An) --- V10&9&8 (AF & BF & CF)

V10 (AF) --- V9&V8 (BF & CF)

V9 (BF) --- V8 (CF)

V8 (CF) --- V7 (DF)

```{r relationship between labels and features}
imagem1[,3:11] %>%
  filter(label!=0)  %>%
  group_by(label) %>%
  pivot_longer(cols = "NDAI":"AN", names_to = "feature") %>%
  ggplot(aes(x = label, y = value, group = label))+
  geom_boxplot(outlier.size = 0.1)+
  facet_wrap(~feature, scales = "free")
```

High NDAI(V4) correspond to cloud (label=1). [make sense]

High SD (V5) -- (not smooth surfaces) correspond to cloud. [make sense]

High CORR (V6) correspond to cloud. (the difference is not much, < 0.3). However, high values of CORR should indicate either cloud-free or low altitude cloud. [low altitude cloud] [Need interpretation]

High Radiance angle AN (V11), AF (V10), BF (V9) correspond to no cloud.

High Radiance angle DF (V7) correspond to cloud. [Not included]


```{r single boxplot}
imagem3[,3:11] %>%
  filter(label!=0)  %>%
  group_by(label) %>%
  pivot_longer(cols = "NDAI":"AN", names_to = "feature") %>%
  ggplot(aes(x = label, y = value, group = label))+
  geom_boxplot(outlier.size = 0.1)+
  facet_wrap(~feature, scales = "free")
```







