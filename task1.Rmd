---
title: "task1"
author: "Yanjiao"
date: "2022-11-15"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(patchwork)
knitr::opts_chunk$set(echo = TRUE)
```

```{r load data}
imagem1 = read.table("image_data/imagem1.txt")
imagem2 = read.table("image_data/imagem2.txt")
imagem3 = read.table("image_data/imagem3.txt")
```

# b
As for the first image, 37.3% pixels are labeled as "not cloud", 34.1% are labeled as "cloud" and 28.6% have no labels. As for the second image, there are 43.8% labeled as "not cloud", 17.8% labeled as "cloud" and 38.5% with no labels. As for the third image, 29.3% are labeled as "not cloud", 18.4% are labeled as "cloud" and 52.3% have no labels.
```{r summarize the data}
imagem1 %>%
  group_by(V3, .drop=TRUE) %>%
  summarise(n()/dim(.)[1])

imagem2 %>%
  group_by(V3, .drop=TRUE) %>%
  summarise(n()/dim(.)[1])

imagem3 %>%
  group_by(V3, .drop=TRUE) %>%
  summarise(n()/dim(.)[1])
```

```{r plot maps, cache=TRUE, fig.height=8}
p1 = imagem1 %>%
  filter(V3!=0) %>%
  ggplot(aes(x = V2, y = V1, col = factor(V3)))+
  geom_point()+
  scale_color_manual(values = c("grey", "white"))+
  labs(x = "x", y = "y")+
  theme(legend.position = "none",
        panel.border = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "black"))

p2 = imagem2 %>%
  filter(V3!=0) %>%
  ggplot(aes(x = V2, y = V1, col = factor(V3)))+
  geom_point()+
  scale_color_manual(values = c("grey", "white"))+
  labs(x = "x", y = "y")+
  theme(legend.position = "none",
        panel.border = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "black"))

p3 = imagem3 %>%
  filter(V3!=0) %>%
  ggplot(aes(x = V2, y = V1, col = factor(V3)))+
  geom_point()+
  scale_color_manual(values = c("grey", "white"))+
  labs(x = "x", y = "y")+
  theme(legend.position = "none",
        panel.border = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "black"))

p1+p2+p3+plot_layout(nrow = 3, ncol = 1)
```

## c

```{r pairwise relationship, cache=TRUE}
library(GGally)
imagem1 %>%
  select(V3:V11) %>%
  ggpairs()
```

```{r corplot, cache=TRUE}
# pairwise correlation between features
library(ggcorrplot)
imagem1 %>%
  select(V4:V11) %>%
  ggcorr(label = TRUE, label_alpha = TRUE, low = "steelblue", mid = "white", high = "darkred")
```

CORR: V6 --- 4&5 MISR view direction (Af&An) --- V10&V11

SD: V5 --- k=5 MISR(An) --- V11 (Not too strong) 

NDAI: V4 --- (Not too strong)

V11 (An) --- V10&9&8 (AF & BF & CF)

V10 (AF) --- V9&V8 (BF & CF)

V9 (BF) --- V8 (CF)

V8 (CF) --- V7 (DF)

```{r relationship between labels and features}
imagem1[,3:11] %>%
  filter(V3!=0)  %>%
  group_by(V3) %>%
  pivot_longer(cols = "V4":"V11", names_to = "feature") %>%
  ggplot(aes(x = V3, y = value, group = V3))+
  geom_boxplot(outlier.size = 0.1)+
  facet_wrap(~feature, scales = "free")
```

High NDAI(V4) correspond to cloud (label=1). [make sense]

High Radiance angle AN (V11), AF (V10), BF (V9) correspond to no cloud.

High Radiance angle DF (V7) correspond to cloud.

High SD (V5) -- (not smooth surfaces) correspond to cloud. [make sense]

High CORR (V6) correspond to cloud. (the difference is not much, < 0.3). However, high values of CORR should indicate either cloud-free or low altitude cloud. [Not included because the difference is small?]

```{r single boxplot}
imagem1[,3:11] %>%
  filter(V3!=0)  %>%
  group_by(V3) %>%
  ggplot(aes(x = V3, y = V6, group = V3))+
  geom_boxplot(outlier.size = 0.1)
```







